# 设计篇

在建设一个网站时，其最初的设计往往会对整个系统起到至关重要的影响。因此，在众多不同方面之中，我们先来讨论下系统的一些设计规则，

本篇内容概括如下：

1. 避免复杂的方案和过度设计
2. 尽量使用统一的技术和框架
3. 系统需要具备垂直伸缩及水平伸缩的能力
4. 努力消除系统中的单点
5. 为系统中的热点降温
6. 保证操作的幂等性
7. 系统间的交互尽量采用异步方式

## Rule 1. 避免复杂的方案和过度设计

### 目的描述

避免出现过于复杂的系统设计和实现，尤其是看似超前的过度设计。

### 实践要点

任何系统中都应尽量避免复杂的设计，尤其是过度设计，不仅增加了工作量，还提升了开发和运维的难度，却没有带来相应的好处。

> 做的复杂不难，做的简单才难

在满足系统今后一段时间内的可扩展性和稳定性要求的同事，尽力那个避免复杂的架构和局部实现，以简单的方式直接实现需求。一个难以理解的方案，同样会难于实现和运维。

此外，不要为了虚无缥缈的目标进行设计，例如，原本要求为一家中型公司设计CRM和ERP，但是在具体设计方案时却按照2000万用户的级别来设计，这已经和上海市的人口在一个数量级上了，显然远远超出了实际需求。

### 检查方式

在完成大概的设计后，再找几位没有参与设计的同学，向他们叙述方案，如果对方不能很快理解设计方案，说明该方案过于复杂。如果设计的方案能够支持未来5-10年的需求，那也许可以考虑在实现上加以简化。

### 案例说明

## Rule 2. 尽量使用统一的技术和框架

### 目的描述

在同一个公司内，如非必要，尽量采用统一的技术和框架，避免出现技术繁杂的情况，过多的异构系统会带来一定的运维成本，不同系统的运维方式不同，配置也不尽相同，突然引入的新技术可能对现有体系带来一定的冲击。

### 实践要点

在现有体系中如果需要新建系统，在技术选型时，可以考虑采用与现有系统相近的技术和框架；如果公司有成熟的内部框架，更应该首先考虑使用内部框架，原因是内部框架一般都会更加符合公司的情况，且遇到问题时能够得到更快速的响应。不要出于个人喜好选择不同，甚至是另类的框架和技术，比如在一家以Java为主的公司里，在生产系统中使用Lisp就比较另类，尤其是在处理能用Java解决的问题时。

如果遇到新的需求和问题，需要引入新技术解决，也应选择与公司主流技术相近的技术。以大数据为例，如果公司的主流开发语言是Java，那么选择Hadoop体系的解决方案，学习曲线相比更平滑，部署和维护时也会更加方便。因为有丰富的Java系统运维经验，所以运维Hadoop会比运维其他平台更加得心应手。

### 检查方式

查看系统的代码，是否存在大量不同的实现语言；针对类似的需求，是否出现了不同的框架。如果有公司的内部框架，是否是基于该框架搭建的系统，还是使用了其他框架。

### 案例说明

以搭建一个Web应用为例，公司的主流应用都选择Spring MVC，那么在新建系统时，就应该首先考虑使用Java，并且选择Spring MVC作为基础。不要使用Struts，甚至是使用PHP来开发应用。选择统一的框架好处很多，比如在遇到框架问题时，可以统一修复，然后集中打补丁，如果框架不同，那么面对同一个问题就需要有多套解决方案。

既然大多数系统都是Java的，那么在运维方面会积累不少Java相关的经验，比如部署和调优，如果突然出现一个PHP的系统，那么Java方面的经验基本就无法奏效了，运维的人员不清楚该如何部署和优化PHP的系统。这会给生产环境带来不小的隐患。

## Rule 3. 系统需要具备垂直伸缩及水平伸缩的能力
## Rule 4. 努力消除系统中的单点
## Rule 5. 为系统中的热点降温
## Rule 6. 保证操作的幂等性
## Rule 7. 系统间的交互尽量采用异步方式
